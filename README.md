# CryptoStego  
JS library for steganography with encryption - Hide text in an image with encryption and obfuscation. Support least significant bit mode and fast Fourier mode.    
  
## Version  
v1.3  
  
## DEMO  
[http://stego.js.org](http://stego.js.org)  
**Note: Library needs HTML5 support!**  
   
## Download  
Download [cryptostego.min.js](https://github.com/zeruniverse/CryptoStego/releases/download/v1.3/cryptostego.min.js)  
**Note: This JS library needs HTML5 support!**  
  
## Features  
+ Obfuscation - Random initialization of invalid bits  
+ Non-linear bit-by-bit message storage
+ Valid bits and their order decided by SHA512-based hash function  
+ Password decides the parameter in hash function. Different passwords map message to different locations in the image  
+ No signal for password error. Wrong password results in wrong message
+ LSB (Least Significant Bit) mode
  + Use least significant bits of RGB channels of each pixel to store message  
  + Resulting image is visually identical to original one  
  + Can only be stored in non-compressed format such as PNG  
+ Fast Fourier mode
  + Store information by slightly changing lowest frequency component of each block in frequency domain  
  + Robust to image compression but stores less data compared to LSB mode  
  + Resulting image looks different from original one  
  
## Usage  
This library provides 3 functions. Use `<script src="cryptostego.min.js"></script>` in your HTML to include this library.  
### `loadIMGtoCanvas(inputid, canvasid, callback, maxsize)`  
This function loads an image from file input to a dynamically generated canvas. After that, it will call `callback()` function to do some stuff, and then delete the generated canvas.
  + `inputid` is the id of the html5 file input.
    + You need to put a file input element like `<input type="file" id="file" accept="image/*" />` in your HTML and ask user to select an image here.  
  + `canvasid` is the id of the canvas that this function will generate. **`canvasid` will be generated by this function dynamically when called.** You will use this `canvasid` in `callback()` to locate the canvas.    
    + **You must use an id that not currently used in your HTML**, When this function is called, a canvas with id to be `canvasid` will be created. Then, the image selected by user will be loaded to this canvas.  
    + **Canvas created by this function (`canvasid`) will be deleted after finishing calling callback function.** So you might want to copy image in this canvas to another canvas in callback function or trig a download in callback function.  
  + `callback` is the callback function that will be called after image successfully loaded to canvas.
    + Use `canvasid` to locate the canvas in `callback()` function.  
    + `canvasid` will be deleted after calling `callback()`. Make sure you store all data needed in `callback` function.  
    + An example for callback -> download the result image after steganography:
    ``` JavaScript
    //callback function is writefunc()
    function writefunc(){
        if(writeMsgToCanvas('canvas',$("#msg").val(),$("#pass").val(),3)!=null){ 
        var myCanvas = document.getElementById("canvas"); //canvasid='canvas'  
        var image = myCanvas.toDataURL("image/jpeg",1.0);    
        var element = document.createElement('a');
        element.setAttribute('href', image);
        element.setAttribute('download', 'result.jpg');
        element.style.display = 'none';
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);        
        }
    }
    //For convenience, jQuery is used here. But that's not necessary.
    loadIMGtoCanvas('file','canvas',writefunc,500);
    ```
  + `maxsize` is the max width or height for created canvas (default value is 0)  
    + If either image width or image height larger than `maxsize`, This function scale the image so that it fits the generated canvas with width and height not larger than `maxsize`  
    + If `maxsize`<=0, image will not be scaled (use original size). This is not recommended if your callback function is steganography function (write info to image). As super large image will make browser dead. A recommended value is 500.  
    + Make sure when callback function is reading info from image, your `maxsize` is at least the `maxsize` you use for steganography. As steganography algorithm is not robust to scale.    
  
### `writeMsgToCanvas(canvasid,msg,pass,mode)`  
This function writes your message into image in canvas `canvasid`. Before calling this function, make sure some image is loaded in `canvasid`. Usually, this function will be called in callback function of `loadIMGtoCanvas`  
+ `canvasid` specifies the id of the canvas to whose image the message will be written to.  
+ `msg` specifies the message.  
+ `pass` specifies the password for retrieving the message. (default value is '')  
+ `mode` an integer specifies the steganography mode. [0-5]   
  + `0` -> LSB mode (default), result image looks identical to original image.  
  + `1`, `2` -> fast Fourier mode, result image looks almost identical to original image. Mode `1` stores 19 copies of information and is stable under compression ratio `0.1`. But Mode `1` has very low data capacity.   
  + `3` -> fast Fourier mode, result image looks like images with distortion.  
  + `4`, `5` -> fast Fourier mode, high robustness with bad secrecy. Result image looks very different from original one  
  + Generally, if you don't need image compression robustness, use mode `0`, otherwise, mode `2` and `3` are recommended.
  
+ Return value is either `null` or `1`, `null` stands for `fail` and `1` stands for `success`.  
  
### `readMsgFromCanvas(canvasid,pass,mode)`  
This function reads your message from image in canvas `canvasid`. Before calling this function, make sure some image is loaded in `canvasid`. Usually, this function will be called in callback function of `loadIMGtoCanvas`  
+ **To successfully read message, `pass` and `mode` should be same as what you use in `writeMsgToCanvas`. And the image in `canvasid` should be the result image of `writeMsgToCanvas`.**  
+ All parameters have same meaning as in `writeMsgToCanvas`.  
+ Return value is a string or `null`  
  + `null` means fail to read message. It might caused by wrong password, wrong image or wrong parameters.  
  + returned string is the message retrieved. It might be some meaningless characters on error.  
  
## Compression Robustness for fast Fourier mode  
**Result below is from v1.0 with parameters similar to mode 3 in v1.3. v1.3 should give a better result thanks to algorithm improvement. In v1.3, mode 1 already has resistance to compression ratio 0.1**  
### Raw image and data  
Image before steganography (268KB in PNG format):  
![dandelionclock](https://cloud.githubusercontent.com/assets/4648756/15265727/6b29773e-1941-11e6-9245-3275ff0afcf2.jpg)  

Data:  
```
你好，世界！
HELLO WORLD!
¡HOLA MUNDO!
مرحبا بالعالم!
BONJOUR LE MONDE!
こんにちは世界！
ПРИВЕТ МИР!
```
  
### Compression Ratio 56.0% (150KB)  
![result 3](https://cloud.githubusercontent.com/assets/4648756/15265750/1986efc8-1942-11e6-8f4e-754e4c221f62.jpg)  
Retrieved data correct!  
  
### Compression Ratio 25.8% (69.1KB)  
![optimized-result 3](https://cloud.githubusercontent.com/assets/4648756/15265761/7e502a0a-1942-11e6-918e-f86fce06b001.jpg)  
Retrieved data correct!  
  
### Compression Ratio 16.8% (44.9KB)  
![result 3 1](https://cloud.githubusercontent.com/assets/4648756/15265783/5202b476-1943-11e6-921d-cbf1e1b76075.jpg)  
Result:  
```
你好，世界！
HELLO WORLD!
¡HKL`MUODO!
х阍٨اب诙عالم!
BONJOUR LE MONDE!
こ㊓ㅫメは世界！
ПȠИВЕТ ܐ萠!
```  
Mostly correct!  
  
### Compression Ratio 10% (26.8KB)  
![result 3 __1463194197_207 23 217 104](https://cloud.githubusercontent.com/assets/4648756/15265804/fc1d9c6e-1943-11e6-8325-6a5575447c8b.jpg)  
Result:  
```
你祽，世界＃
ōLO,׏RLD!
áHόA mUNLG 
معЭ記砘蘧لؙܧلمኂϊJOUr(Le MONDQc
こんにちは世界！
ПРИВЕТ МИР!
```  
Half correct!  
  
### Compression Ratio 2.35% (6.3KB)  
![result 3 __1463194357_207 23 217 104](https://cloud.githubusercontent.com/assets/4648756/15265818/7c9b7352-1944-11e6-9f32-3136fcdfb57d.jpg)  
Result:  
```
ERROR RETRIEVING MESSAGE
```  
Corrupted!  
  
## Coding Example  
See `example/` folder  
  
## Developing  
This project is under development. So you might encounter some problems while using it. If so, please submit an issue.  
### Known Issues  
+ Functions for changing higher frequency component in Fourier matrix are implemented. But this method seems not stable.  
+ Functions for fast averaging are implemented. Also, this method is not stable.  
  
## Copyright  
Jeffery Zhao  
License: GNU **A**GPL v3.0 or later  
The copyright for Crypto-JS is reserved by its authors.  
